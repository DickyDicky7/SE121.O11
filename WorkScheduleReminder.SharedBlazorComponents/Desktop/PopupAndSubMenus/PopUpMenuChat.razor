<Animate style="width:100%;height:100%;"
         Animation="Animations.FadeDown"
         Duration="TimeSpan.FromSeconds(0.5)">
    <MudPaper Class="d-flex flex-column gap-2 pa-2 align-center border-2"
              Style="border-radius:20px;overflow:hidden;"
              Elevation="0"
              Width="400px"
              Height="80vh">
        <MudPaper Class="d-flex flex-row align-center"
                  Elevation="0"
                  Width="100%">
            <MudText Style="font-size:large;font-weight:bold;">
                @($"{TaskName}'s Chat")
            </MudText>
        </MudPaper>
        <MudPaper Class="d-flex flex-column gap-2"
                  Style="overflow-y:scroll;"
                  Elevation="0"
                  Width="100%"
                  Height="100%">
            @foreach (Message msg in MessageList)
            {
                if (msg.BelongToThisUser)
                {
                    <MudPaper Class="pa-2 mud-theme-info"
                              Style="border-radius:10px;align-self:end;"
                              Elevation=0
                              MaxWidth="75%">
                        <MudText Style="">
                            @msg.Content
                        </MudText>
                    </MudPaper>
                }
                else
                {
                    <MudPaper Class="d-flex flex-row gap-2"
                              Style="align-self:start"
                              Elevation="0"
                              MaxWidth="75%">
                        <MudAvatar>
                            <MudImage Src="" />
                        </MudAvatar>
                        <MudPaper Class="pa-2 mud-theme-warning"
                                  Style="border-radius:10px;"
                                  Elevation=0
                                  MaxWidth="100%">
                            <MudText Style="">
                                @msg.Content
                            </MudText>
                        </MudPaper>
                    </MudPaper>

                }
            }
        </MudPaper>
        <MudPaper Class="d-flex flex-row"
                  Elevation="0"
                  Width="100%">
            <MudTextField @bind-Value=NewMessage
                          Immediate=true
                          FullWidth=true
                          Placeholder="Enter message"
                          DisableUnderLine=true
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          TextUpdateSuppression=false />
            <MudIconButton Icon="@Icons.Material.Filled.Send"
                           Color="Color.Info"
                           OnClick="AddMessage" />
        </MudPaper>
    </MudPaper>
</Animate>

@code {
    [Parameter(CaptureUnmatchedValues = true)]
    public IDictionary<string, object>? AdditionalAttributes { get; set; }

    public string NewMessage = string.Empty;
    public string TaskName = "Task Name";

    public record Message
    {
        public string Content { get; set; } = default!;
        public bool BelongToThisUser { get; set; } = true;
        public DateTime DateTimeCreated { get; set; } = default!;
    }
    public List<Message> MessageList { get; set; } = new();
    public void AddMessage()
    {
        MessageList.Add(new Message()
            {
                Content = NewMessage,
                DateTimeCreated = DateTime.Now
            });
        NewMessage = string.Empty;
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        foreach (int i in Enumerable.Range(1, 30))
        {
            if (i % 2 == 0)
            {
                if (i % 3 == 0)
                {
                    MessageList.Add(new Message()
                        {
                            Content = $"Message {i}: This sentence contain a lot of words words words words"
                        });
                }
                else
                {
                    MessageList.Add(new Message()
                        {
                            Content = $"Message {i}"
                        });
                }
            }
            else
            {
                if (i % 3 == 0)
                {
                    MessageList.Add(new Message()
                        {
                            Content = $"Message {i}: This sentence contain a lot of words words words words",
                            BelongToThisUser = false
                        });
                }
                else
                {
                    MessageList.Add(new Message()
                        {
                            Content = $"Message {i}",
                            BelongToThisUser = false
                        });
                }
            }
        }

    }
}
