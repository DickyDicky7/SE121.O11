@using Supabase.Gotrue
@using Supabase.Gotrue.Interfaces
@using Microsoft.AspNetCore.Components.Authorization
@using WorkScheduleReminder.SharedBlazorComponents.Mobile_
@using WorkScheduleReminder.SharedBlazorComponents.Desktop

@implements IDisposable
@inject     Supabase.Client SupabaseClient

<MudThemeProvider /><MudDialogProvider /><MudSnackbarProvider />

<CascadingAuthenticationState>
	<AuthorizeView>
		<Authorized>
			@switch (DeviceType)
			{
				case Helper.DeviceType.Mobile:
					<MobileParentAuthorized  MainChildContent="@ChildContent" />
					 break;

				case Helper.DeviceType.Desktop:
					<DesktopParentAuthorized MainChildContent="@ChildContent" />
					 break;

				case Helper.DeviceType.Unknown:
					 break;
			}
		</Authorized>
		<Authorizing>
			<MudText>Authorizing</MudText>
		</Authorizing>
		<NotAuthorized>
			@switch (DeviceType)
			{
				case Helper.DeviceType.Mobile:
					<MobileParentNotAuthorized  />
					 break;

				case Helper.DeviceType.Desktop:
					<DesktopParentNotAuthorized />
					 break;

				case Helper.DeviceType.Unknown:
					 break;
			}
		</NotAuthorized>
	</AuthorizeView>
</CascadingAuthenticationState>

@code
{

	[Parameter]
	public RenderFragment? ChildContent { get; set; }
	[Parameter]
	public Helper.DeviceType DeviceType { get; set; }

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
	}

	protected async void AuthEventHandler(IGotrueClient<User, Session> gotrueClient, Constants.AuthState authState)
	{
	}

	public void Dispose()
	{
		SupabaseClient.Auth.RemoveStateChangedListener(AuthEventHandler);
	}

}
