@using Supabase.Gotrue
@using Supabase.Gotrue.Interfaces
@using Microsoft.AspNetCore.Components.Authorization
@using WorkScheduleReminder.SharedBlazorComponents.Mobile_
@using WorkScheduleReminder.SharedBlazorComponents.Desktop

@implements IDisposable
@inject     Supabase.Client SupabaseClient

<MudThemeProvider Theme="Helper.CustomThemes[1]" /><MudDialogProvider /><MudSnackbarProvider />

<CascadingAuthenticationState>
	<AuthorizeView>
		<Authorized>
			@switch (DeviceType)
			{
				case Helper.DeviceType.Mobile:
					<MobileParentAuthorized  MainChildContent="@ChildContent" />
					 break;

				case Helper.DeviceType.Desktop:
					<DesktopParentAuthorized MainChildContent="@ChildContent" />
					 break;

				case Helper.DeviceType.Unknown:
					 break;
			}
		</Authorized>
		<Authorizing>
			<MudText>Authorizing</MudText>
		</Authorizing>
		<NotAuthorized>
			@switch (DeviceType)
			{
				case Helper.DeviceType.Mobile:
					<MobileParentNotAuthorized  />
					 break;

				case Helper.DeviceType.Desktop:
					<DesktopParentNotAuthorized />
					 break;

				case Helper.DeviceType.Unknown:
					 break;
			}
		</NotAuthorized>
	</AuthorizeView>
</CascadingAuthenticationState>

@code
{

	[Parameter]
	public RenderFragment? ChildContent { get; set; }
	[Parameter]
	public Helper.DeviceType DeviceType { get; set; }

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
	}

	protected void AuthEventHandler(IGotrueClient<User, Session> gotrueClient, Constants.AuthState authState)
	{
		System.Diagnostics.Debug.WriteLine(authState);
		switch (authState)
		{
			case Constants.AuthState.Shutdown:
				 break;

			case Constants.AuthState.SignedIn:
				 break;

			case Constants.AuthState.SignedOut:
				 break;

			case Constants.AuthState.UserUpdated:
				 break;

			case Constants.AuthState.TokenRefreshed:
				 break;

			case Constants.AuthState.PasswordRecovery:
				 break;
		}
	}

	public void Dispose()
	{
		SupabaseClient.Auth.RemoveStateChangedListener(AuthEventHandler);
	}

}
